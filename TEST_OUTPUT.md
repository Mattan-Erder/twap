
```console

> @orbs-network/twap@1.0.0 test
> for t in eth ftm poly; do npm run test:$t; done


> @orbs-network/twap@1.0.0 test:eth
> NETWORK=ETH BLOCK=14908980 hardhat test


๐ network ETH blocknumber 14908980 ๐



  Errors
    โ cancel only from maker (466ms)
    โ prune only invalid orders (7402ms)
    โ bid params (12ms)
    order
      โ invalid id (7ms)
      โ invalid params (25ms)
      โ insufficient maker allowance (18ms)
      โ insufficient maker balance (428ms)
    verify bid
      โ expired (66ms)
      โ invalid exchange (1065ms)
      โ low bid (87ms)
      โ recently filled (115ms)
      โ recently filled custom delay (115ms)
      โ insufficient amount out (34ms)
      โ insufficient amount out with excess fee (38ms)
      โ fee underflow protection (35ms)
      โ insufficient amount out when last partial fill (118ms)
      โ insufficient user allowance (42ms)
      โ insufficient user balance (47ms)
    perform fill
      โ expired (45ms)
      โ invalid taker when no existing bid (29ms)
      โ invalid taker when not the winning taker (44ms)
      โ pending bid when still in bidding window (47ms)
      โ insufficient out (652ms)
      โ insufficient out with excess fee (76ms)
      โ fee subtracted from dstAmountOut underflow protection (81ms)

  IExchange implementations
    UniswapV2Exchange
      โ swap (244ms)
      fee on transfer tokens
        โ throws on normal swap (33ms)
        โ sell tokens with FoT (37ms)
    ParaswapExchange
FTM only
      - getAmountOut using pure encoded data from offchain
      - swap with data from paraswap

  Sanity
    โ maker creates ask order, emits event (28ms)
    โ bid sets Bid fields, emits event (46ms)
    โ fill sets Fill fields and clears the Bid, emits event (85ms)
    โ cancel order, emits event (40ms)
    โ order fully filled, emits event (156ms)
    History
      โ find orders for maker (218ms)

  TWAP
    โ single chunk (91ms)
    โ mutiple chunks (313ms)
    โ last chunk may be partial amount (229ms)
    โ outbid current bid within pending period (98ms)
    โ outbid current bid within pending period same path and amount but lower fee (63ms)
    โ enforce bids 1% better than previous (86ms)
    โ clears stale unfilled bid after max bidding window (81ms)
    โ supports market orders, english auction incentivizes best competitive price (156ms)
    โ prevent winning the bid by manipulating exchange price (78ms)
    โ supports FoT tokens (103ms)
    prune stale invalid order
      โ when no approval (37ms)
      โ when no balance (436ms)

ยท--------------------------------------------|---------------------------|-------------|-----------------------------ยท
|            Solc version: 0.8.16            ยท  Optimizer enabled: true  ยท  Runs: 200  ยท  Block limit: 15000000 gas  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Methods                                   ยท               30 gwei/gas               ยท       1303.04 usd/eth       โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Contract               ยท  Method          ยท  Min        ยท  Max        ยท  Avg        ยท  # calls      ยท  usd (avg)  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  approve         ยท      38027  ยท      60311  ยท      57462  ยท           47  ยท       2.25  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  transfer        ยท      51618  ยท      65625  ยท      63244  ยท           59  ยท       2.47  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken  ยท  approve         ยท      46260  ยท      46572  ยท      46370  ยท            6  ยท       1.81  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange           ยท  setMockAmounts  ยท      32144  ยท      69156  ยท      52960  ยท           16  ยท       2.07  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  ask             ยท     236904  ยท     308314  ยท     282487  ยท           43  ยท      11.04  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  bid             ยท     115820  ยท     297868  ยท     265983  ยท           41  ยท      10.40  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  cancel          ยท      73539  ยท      73601  ยท      73560  ยท            3  ยท       2.88  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  fill            ยท     274797  ยท     354886  ยท     330133  ยท           18  ยท      12.91  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  prune           ยท      86772  ยท      90731  ยท      88752  ยท            2  ยท       3.47  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange      ยท  swap            ยท     166014  ยท     186348  ยท     176181  ยท            2  ยท       6.89  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Deployments                               ยท                                         ยท  % of limit   ยท             โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken                     ยท          -  ยท          -  ยท     733793  ยท        4.9 %  ยท      28.68  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange                              ยท          -  ยท          -  ยท     503943  ยท        3.4 %  ยท      19.70  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                                      ยท          -  ยท          -  ยท    2660714  ยท       17.7 %  ยท     104.01  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange                         ยท          -  ยท          -  ยท     717701  ยท        4.8 %  ยท      28.06  โ
ยท--------------------------------------------|-------------|-------------|-------------|---------------|-------------ยท

  46 passing (50s)
  2 pending


> @orbs-network/twap@1.0.0 test:ftm
> NETWORK=FTM BLOCK=39838819 hardhat test


๐ network FTM blocknumber 39838819 ๐



  Errors
    โ cancel only from maker (238ms)
    โ prune only invalid orders (5389ms)
    โ bid params (15ms)
    order
      โ invalid id (8ms)
      โ invalid params (27ms)
      โ insufficient maker allowance (16ms)
      โ insufficient maker balance (187ms)
    verify bid
      โ expired (72ms)
      โ invalid exchange (898ms)
      โ low bid (91ms)
      โ recently filled (124ms)
      โ recently filled custom delay (126ms)
      โ insufficient amount out (38ms)
      โ insufficient amount out with excess fee (34ms)
      โ fee underflow protection (35ms)
      โ insufficient amount out when last partial fill (133ms)
      โ insufficient user allowance (42ms)
      โ insufficient user balance (45ms)
    perform fill
      โ expired (50ms)
      โ invalid taker when no existing bid (28ms)
      โ invalid taker when not the winning taker (46ms)
      โ pending bid when still in bidding window (46ms)
      โ insufficient out (377ms)
      โ insufficient out with excess fee (91ms)
      โ fee subtracted from dstAmountOut underflow protection (77ms)

  IExchange implementations
    UniswapV2Exchange
      โ swap (212ms)
      fee on transfer tokens
        โ throws on normal swap (181ms)
        โ sell tokens with FoT (38ms)
    ParaswapExchange
      โ getAmountOut using pure encoded data from offchain (6ms)
      โ swap with data from paraswap (10234ms)

  Sanity
    โ maker creates ask order, emits event (28ms)
    โ bid sets Bid fields, emits event (45ms)
    โ fill sets Fill fields and clears the Bid, emits event (103ms)
    โ cancel order, emits event (43ms)
    โ order fully filled, emits event (180ms)
    History
      โ find orders for maker (155ms)

  TWAP
    โ single chunk (95ms)
    โ mutiple chunks (317ms)
    โ last chunk may be partial amount (230ms)
    โ outbid current bid within pending period (117ms)
    โ outbid current bid within pending period same path and amount but lower fee (74ms)
    โ enforce bids 1% better than previous (89ms)
    โ clears stale unfilled bid after max bidding window (87ms)
    โ supports market orders, english auction incentivizes best competitive price (147ms)
    โ prevent winning the bid by manipulating exchange price (78ms)
    โ supports FoT tokens (419ms)
    prune stale invalid order
      โ when no approval (42ms)
      โ when no balance (198ms)

ยท--------------------------------------------|---------------------------|-------------|-----------------------------ยท
|            Solc version: 0.8.16            ยท  Optimizer enabled: true  ยท  Runs: 200  ยท  Block limit: 15000000 gas  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Methods                                   ยท               1 gwei/gas                ยท        0.20 usd/ftm         โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Contract               ยท  Method          ยท  Min        ยท  Max        ยท  Avg        ยท  # calls      ยท  usd (avg)  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  approve         ยท      24299  ยท      46583  ยท      43794  ยท           48  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  transfer        ยท      46731  ยท      52345  ยท      51415  ยท           61  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken  ยท  approve         ยท      46260  ยท      46572  ยท      46370  ยท            6  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange           ยท  setMockAmounts  ยท      32144  ยท      69156  ยท      52960  ยท           16  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ParaswapExchange       ยท  swap            ยท          -  ยท          -  ยท     372382  ยท            1  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  ask             ยท     229096  ยท     300506  ยท     274861  ยท           43  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  bid             ยท     111054  ยท     322473  ยท     284532  ยท           41  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  cancel          ยท      73539  ยท      73601  ยท      73560  ยท            3  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  fill            ยท     267388  ยท     396959  ยท     367499  ยท           18  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  prune           ยท      79682  ยท      82923  ยท      81303  ยท            2  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange      ยท  swap            ยท     193833  ยท     207562  ยท     200698  ยท            2  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Deployments                               ยท                                         ยท  % of limit   ยท             โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken                     ยท          -  ยท          -  ยท     733793  ยท        4.9 %  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange                              ยท          -  ยท          -  ยท     503943  ยท        3.4 %  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ParaswapExchange                          ยท          -  ยท          -  ยท     621334  ยท        4.1 %  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                                      ยท          -  ยท          -  ยท    2660714  ยท       17.7 %  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange                         ยท          -  ยท          -  ยท     717701  ยท        4.8 %  ยท       0.00  โ
ยท--------------------------------------------|-------------|-------------|-------------|---------------|-------------ยท

  48 passing (1m)


> @orbs-network/twap@1.0.0 test:poly
> NETWORK=POLY BLOCK=29194866 hardhat test


๐ network POLY blocknumber 29194866 ๐



  Errors
    โ cancel only from maker (481ms)
    โ prune only invalid orders (17199ms)
    โ bid params (16ms)
    order
      โ invalid id (8ms)
      โ invalid params (28ms)
      โ insufficient maker allowance (17ms)
      โ insufficient maker balance (2359ms)
    verify bid
      โ expired (65ms)
      โ invalid exchange (1241ms)
      โ low bid (88ms)
      โ recently filled (129ms)
      โ recently filled custom delay (125ms)
      โ insufficient amount out (33ms)
      โ insufficient amount out with excess fee (35ms)
      โ fee underflow protection (32ms)
      โ insufficient amount out when last partial fill (113ms)
      โ insufficient user allowance (42ms)
      โ insufficient user balance (42ms)
    perform fill
      โ expired (51ms)
      โ invalid taker when no existing bid (28ms)
      โ invalid taker when not the winning taker (44ms)
      โ pending bid when still in bidding window (46ms)
      โ insufficient out (3101ms)
      โ insufficient out with excess fee (87ms)
      โ fee subtracted from dstAmountOut underflow protection (104ms)

  IExchange implementations
    UniswapV2Exchange
      โ swap (259ms)
      fee on transfer tokens
        โ throws on normal swap (233ms)
        โ sell tokens with FoT (61ms)
    ParaswapExchange
FTM only
      - getAmountOut using pure encoded data from offchain
      - swap with data from paraswap

  Sanity
    โ maker creates ask order, emits event (27ms)
    โ bid sets Bid fields, emits event (41ms)
    โ fill sets Fill fields and clears the Bid, emits event (87ms)
    โ cancel order, emits event (41ms)
    โ order fully filled, emits event (156ms)
    History
      โ find orders for maker (221ms)

  TWAP
    โ single chunk (86ms)
    โ mutiple chunks (301ms)
    โ last chunk may be partial amount (234ms)
    โ outbid current bid within pending period (104ms)
    โ outbid current bid within pending period same path and amount but lower fee (69ms)
    โ enforce bids 1% better than previous (85ms)
    โ clears stale unfilled bid after max bidding window (82ms)
    โ supports market orders, english auction incentivizes best competitive price (138ms)
    โ prevent winning the bid by manipulating exchange price (91ms)
    โ supports FoT tokens (557ms)
    prune stale invalid order
      โ when no approval (35ms)
      โ when no balance (496ms)

ยท--------------------------------------------|---------------------------|-------------|-----------------------------ยท
|            Solc version: 0.8.16            ยท  Optimizer enabled: true  ยท  Runs: 200  ยท  Block limit: 15000000 gas  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Methods                                   ยท               91 gwei/gas               ยท       0.82 usd/matic        โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Contract               ยท  Method          ยท  Min        ยท  Max        ยท  Avg        ยท  # calls      ยท  usd (avg)  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  approve         ยท      36162  ยท      58446  ยท      55597  ยท           47  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  ERC20                  ยท  transfer        ยท      51994  ยท      63552  ยท      61545  ยท           59  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken  ยท  approve         ยท      46260  ยท      46572  ยท      46370  ยท            6  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange           ยท  setMockAmounts  ยท      32144  ยท      69156  ยท      52960  ยท           16  ยท       0.00  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  ask             ยท     234673  ยท     306083  ยท     280308  ยท           43  ยท       0.02  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  bid             ยท     113589  ยท     295637  ยท     263807  ยท           41  ยท       0.02  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  cancel          ยท      73539  ยท      73601  ยท      73560  ยท            3  ยท       0.01  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  fill            ยท     276989  ยท     358440  ยท     333426  ยท           18  ยท       0.02  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                   ยท  prune           ยท      84634  ยท      88500  ยท      86567  ยท            2  ยท       0.01  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange      ยท  swap            ยท     167530  ยท     186486  ยท     177008  ยท            2  ยท       0.01  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  Deployments                               ยท                                         ยท  % of limit   ยท             โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockDeflationaryToken                     ยท          -  ยท          -  ยท     733793  ยท        4.9 %  ยท       0.05  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  MockExchange                              ยท          -  ยท          -  ยท     503943  ยท        3.4 %  ยท       0.04  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  TWAP                                      ยท          -  ยท          -  ยท    2660714  ยท       17.7 %  ยท       0.20  โ
ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยทยท|ยทยทยทยทยทยทยทยทยทยทยทยทยทยท
|  UniswapV2Exchange                         ยท          -  ยท          -  ยท     717701  ยท        4.8 %  ยท       0.05  โ
ยท--------------------------------------------|-------------|-------------|-------------|---------------|-------------ยท

  46 passing (1m)
  2 pending

```
